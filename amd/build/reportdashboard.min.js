/**
 * TODO describe module reportdashboard
 *
 * @module     block_reportdashboard/reportdashboard
 * @copyright  2023 Moodle India
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_reportdashboard/reportdashboard",["jquery","core/ajax","block_learnerscript/report","block_learnerscript/reportwidget","block_learnerscript/schedule","block_learnerscript/helper","block_learnerscript/ajax","block_learnerscript/config","block_learnerscript/select2","block_learnerscript/datatables","block_learnerscript/smartfilter","block_learnerscript/radioslider","block_learnerscript/flatpickr","core/str","jqueryui","block_learnerscript/bootstrapnotify"],(function($,Ajax,report,reportwidget,schedule,helper,ajax,cfgs,select2,dataTable,smartfilter,RadiosToSlider,flatpickr,Str){return{init:function(){$(document).ajaxStop((function(){$(".loader").fadeOut("slow")})),helper.Select2Ajax({}),$(".dashboardcourses").change((function(){var courseid=$(this).val();$(".report_courses").val(courseid),reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")}))})),$("#createdashbaord_form").submit((function(event){var name=$("#id_dashboard").val().trim();""!=name&&null!==name||($("#id_error_dashboard").css("display","block"),$("#id_error_dashboard_nospaces").css("display","none"),event.preventDefault());var spaceexist=name.indexOf(" ");spaceexist>0&&""!=spaceexist&&($("#id_error_dashboard").css("display","none"),$("#id_error_dashboard_nospaces").css("display","block"),event.preventDefault())})),$.ui.dialog.prototype._focusTabbable=$.noop;var DheaderPosition=$("#dashboard-header").position();$(".sidenav").offset({top:0}),$("#internalbsm").offset({top:DheaderPosition.top}),$("select[data-select2='1']").select2(),helper.Select2Ajax({action:"reportlist",multiple:!0}),$(document).on("click",".filterform #id_filter_clear",(function(){$(this).parents(".mform").trigger("reset");var activityelement=$(this).parents(".mform").find("#id_filter_activities"),instancelement=$(this).parents(".block_reportdashboard").find(".report_dashboard_container"),reportid=instancelement.data("reportid"),reporttype=instancelement.data("reporttype"),instanceid=instancelement.data("blockinstance");smartfilter.CourseActivities({courseid:0,element:activityelement}),$(".filterform select[data-select2-ajax='1']").val("0").trigger("change"),$(".filterform")[0].reset(),$(".filterform #id_filter_clear").attr("disabled","disabled"),reportwidget.CreateDashboardwidget({reportid:reportid,reporttype:reporttype,instanceid:instanceid})})),$(document).on("change","select[name='filter_coursecategories']",(function(){var categoryid=this.value,courseelement=$(this).closest(".mform").find("#id_filter_courses");0!=courseelement.length&&smartfilter.categoryCourses({categoryid:categoryid,element:courseelement})})),$(document).on("change","select[name='filter_courses']",(function(){var courseid=this.value,activityelement=$(this).closest(".mform").find("#id_filter_activities");0!=activityelement.length&&smartfilter.CourseActivities({courseid:courseid,element:activityelement})})),RadiosToSlider.init($("#segmented-button"),{size:"medium",animation:!0,reportdashboard:!0}),flatpickr("#customrange",{mode:"range",onOpen:function(selectedDates,dateStr,instance){instance.clear()},onClose:function(selectedDates){$("#lsfstartdate").val(selectedDates[0].getTime()/1e3),$("#lsfenddate").val(selectedDates[1].getTime()/1e3+86400),require(["block_learnerscript/reportwidget"],(function(){reportwidget.DashboardTiles(),reportwidget.DashboardWidgets()}))}}),window.onclick=function(event){if(!event.target.matches(".dropbtn")){var i,dropdowns=document.getElementsByClassName("dropdown-content");for(i=0;i<dropdowns.length;i++){var openDropdown=dropdowns[i];$(openDropdown).hasClass("show")&&$(openDropdown).toggleClass("show")}}}},sendreportemail:function(args){Str.get_strings([{key:"sendemail",component:"block_reportdashboard"}]).then((function(s){var url=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";args.nodeContent="sendreportemail"+args.instanceid,args.action="sendreportemail",args.title=s,require("block_learnerscript/ajaxforms").init(args,url)}))},reportfilter:function(args){var self=this;$(".report_filter_"+args.instanceid).length<1?Ajax.call([{methodname:"block_learnerscript_reportfilter",args:{action:"reportfilter",reportid:args.reportid,instance:args.instanceid}}])[0].done((function(resp){$("body").append("<div class='report_filter_"+args.instanceid+"' style='display:none;'>"+resp+"</div>"),$("select[data-select2-ajax='1']").each((function(){$(this).hasClass("select2-hidden-accessible")||helper.Select2Ajax({})})),self.reportFilterFormModal(args),$(".filterform"+args.instanceid+" .fitemtitle").hide(),$(".filterform"+args.instanceid+" .felement").attr("style","margin:0")})):self.reportFilterFormModal(args)},reportFilterFormModal:function(args){Str.get_string("reportfilters","block_reportdashboard").then((function(s){var titleimg="<img class='dialog_title_icon' alt='Filter' src='"+M.util.image_url("reportfilter","block_reportdashboard")+"'/>";$(".report_filter_"+args.instanceid).dialog({title:s,dialogClass:"reportfilter-popup",modal:!0,resizable:!0,autoOpen:!0,draggable:!1,width:420,height:"auto",appendTo:"#inst"+args.instanceid,position:{my:"center",at:"center",of:"#inst"+args.instanceid,within:"#inst"+args.instanceid},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"}),$(this).closest(".ui-dialog").find(".ui-dialog-title").html(titleimg+s),$(".report_filter_"+args.instanceid+" form  #id_filter_apply").click((function(e){e.preventDefault(),e.stopImmediatePropagation(),$("#reportcontainer"+args.instanceid).html().length>0?args.reporttype=$("#reportcontainer"+args.instanceid).data("reporttype"):args.reporttype=$("#plotreportcontainer"+args.instanceid).data("reporttype"),args.container="#reporttype_"+args.reportid,require(["block_learnerscript/reportwidget"],(function(reportwidget){reportwidget.CreateDashboardwidget({reportid:args.reportid,reporttype:args.reporttype,instanceid:args.instanceid}),$(".report_filter_"+args.instanceid).dialog("close")})),$(".report_filter_"+args.instanceid+" form #id_filter_clear").removeAttr("disabled")}))}}),$(".report_filter_"+args.instanceid+" form #id_filter_clear").click((function(e){e.preventDefault(),$(".filterform"+args.instanceid+" select[data-select2-ajax='1']").val("0").trigger("change"),$(".filterform"+args.instanceid).trigger("reset"),require(["block_learnerscript/reportwidget"],(function(reportwidget){reportwidget.DashboardWidgets(args),$(".report_filter_"+args.instanceid).dialog("close")})),$(".report_filter_"+args.instanceid).dialog("close")}))}))},DeleteWidget:function(args){Str.get_string("deletewidget","block_reportdashboard").then((function(s){$("#delete_dialog"+args.instanceid).dialog({resizable:!0,autoOpen:!0,width:460,height:210,title:s,modal:!0,appendTo:"#inst"+args.instanceid,position:{my:"center",at:"center",of:"#inst"+args.instanceid,within:"#inst"+args.instanceid},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"})}})}))},schreportform:function(args){Str.get_string("schedulereport","block_reportdashboard").then((function(s){var url=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";args.title=s,args.nodeContent="schreportform"+args.instanceid,args.action="schreportform",args.courseid=$('[name="filter_courses"]').val(),require("block_learnerscript/ajaxforms").init(args,url)}))}}}));

//# sourceMappingURL=reportdashboard.min.js.map